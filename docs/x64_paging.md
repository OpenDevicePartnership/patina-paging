# X64 - 4K 5 Level Paging

```txt
     63           57 56           48 47           39 38           30 29            21 20            12 11               0
     ┌──────────────┬───────────────┬───────────────┬───────────────┬────────────────┬────────────────┬──────────────────┐
     │ Sign         │  PML5E        │ PML4E         │Page Directory │ Page           │ Page           │Physical          │
     │ Extend       │  Offset       │ Offset        │Pointer        │ Directory      │ Table          │Page              │
     │              │               │               │Offset         │ Offset         │ Offset         │Offset            │
     └──────────────┴─┬─────────────┴─┬─────────────┴──┬────────────┴───┬────────────┴───┬────────────┴───┬──────────────┘
                      │9              │9               │9               │9               │9               │12
                      │               │                │                │                │                │
                      │  ┌─────┐      │  ┌─────┐       │  ┌─────┐       │  ┌─────┐       │  ┌─────┐       │  ┌─────┐
                      │  │     │      │  │     │       │  │     │       │  │     │       │  │     │       │  │     │
                      │  │     │      │  │     │       │  │     │       │  │     │       │  │     │       │  │     │
                      │  │     │      │  │     │       │  │     │       │  │     │       │  │     │       │  │     │
                      │  │     │      │  │     │       │  │     │       │  │     │       │  │     │       │  │     │
                      │  ├─────┤      │  ├─────┤       │  ├─────┤       │  ├─────┤       │  ├─────┤       │  ├─────┤
                      └─►│PML5E├───┐  └─►│PML4E│───┐   └─►│PDPE │───┐   └─►│PDE  │───┐   └─►│PTE  │───┐   └─►│ PA  │
                         ├─────┤   │52   ├─────┤   │52    ├─────┤   │52    ├─────┤   │52    ├─────┤   │52    ├─────┤
                         │     │   │     │     │   │      │     │   │      │     │   │      │     │   │      │     │
                  ┌─────►└─────┘   └────►└─────┘   └─────►└─────┘   └─────►└─────┘   └─────►└─────┘   └─────►└─────┘
                  │        4K              4K               4K               4K                4K               4K
                  │
                  │
                  │
                  │
63         52  51 │                               12 11            0
┌─────────────┬───┴─────────────────────────────────┬───────────────┐
│             │    Page-Map Level-4 or Level-5      │               │
│    MBZ      │          Table Base Address         │               │  CR3
│             │                                     │               │
└─────────────┴─────────────────────────────────────┴───────────────┘

4-Kbyte PML5E—Long Mode

63  62              52 51                                    32
┌──┬──────────────────┬────────────────────────────────────────┐
│N │                  │                                        │
│X │     Available    │     Page-Map Level-4 Base Address      │
│  │                  │                                        │
└──┴──────────────────┴────────────────────────────────────────┘

31                                    12 11 9 8 7 6 5 4 3 2 1 0
┌───────────────────────────────────────┬────┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│                                       │    │M│M│I│ │P│P│U│R│ │
│     Page-Map Level-4 Base Address     │AVL │B│B│G│A│C│W│/│/│P│
│                                       │    │Z│Z│N│ │D│T│S│W│ │
└───────────────────────────────────────┴────┴─┴─┴─┴─┴─┴─┴─┴─┴─┘

4-Kbyte PML4E—Long Mode

63  62              52 51                                    32
┌──┬──────────────────┬────────────────────────────────────────┐
│N │                  │                                        │
│X │     Available    │     Page-Map Level-4 Base Address      │
│  │                  │                                        │
└──┴──────────────────┴────────────────────────────────────────┘

31                                    12 11 9 8 7 6 5 4 3 2 1 0
┌───────────────────────────────────────┬────┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│                                       │    │M│M│I│ │P│P│U│R│ │
│     Page-Map Level-4 Base Address     │AVL │B│B│G│A│C│W│/│/│P│
│                                       │    │Z│Z│N│ │D│T│S│W│ │
└───────────────────────────────────────┴────┴─┴─┴─┴─┴─┴─┴─┴─┴─┘

4-Kbyte PDPE—Long Mode

63  62              52 51                                    32
┌──┬──────────────────┬────────────────────────────────────────┐
│N │                  │                                        │
│X │     Available    │     Page-Map Level-4 Base Address      │
│  │                  │                                        │
└──┴──────────────────┴────────────────────────────────────────┘

31                                    12 11 9 8 7 6 5 4 3 2 1 0
┌───────────────────────────────────────┬────┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│                                       │    │M│M│I│ │P│P│U│R│ │
│     Page-Map Level-4 Base Address     │AVL │B│B│G│A│C│W│/│/│P│
│                                       │    │Z│Z│N│ │D│T│S│W│ │
└───────────────────────────────────────┴────┴─┴─┴─┴─┴─┴─┴─┴─┴─┘

4-Kbyte PDE—Long Mode

63  62              52 51                                    32
┌──┬──────────────────┬────────────────────────────────────────┐
│N │                  │                                        │
│X │     Available    │     Page-Map Level-4 Base Address      │
│  │                  │                                        │
└──┴──────────────────┴────────────────────────────────────────┘

31                                    12 11 9 8 7 6 5 4 3 2 1 0
┌───────────────────────────────────────┬────┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│                                       │    │I│ │I│ │P│P│U│R│ │
│     Page-Map Level-4 Base Address     │AVL │G│0│G│A│C│W│/│/│P│
│                                       │    │N│ │N│ │D│T│S│W│ │
└───────────────────────────────────────┴────┴─┴─┴─┴─┴─┴─┴─┴─┴─┘

4-Kbyte PTE—Long Mode

63  62              52 51                                    32
┌──┬──────────────────┬────────────────────────────────────────┐
│N │                  │                                        │
│X │     Available    │     Page-Map Level-4 Base Address      │
│  │                  │                                        │
└──┴──────────────────┴────────────────────────────────────────┘

31                                    12 11 9 8 7 6 5 4 3 2 1 0
┌───────────────────────────────────────┬────┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│                                       │    │ │P│ │ │P│P│U│R│ │
│     Page-Map Level-4 Base Address     │AVL │G│A│D│A│C│W│/│/│P│
│                                       │    │ │T│ │ │D│T│S│W│ │
└───────────────────────────────────────┴────┴─┴─┴─┴─┴─┴─┴─┴─┴─┘
```

## X64 - 2MB 5 Level Paging

```txt
     63           57 56           48 47           39 38           30 29            21 20              0
     ┌──────────────┬───────────────┬───────────────┬───────────────┬────────────────┬─────────────────┐
     │ Sign         │  PML5E        │ PML4E         │Page Directory │ Page           │  Physical       │
     │ Extend       │  Offset       │ Offset        │Pointer        │ Directory      │  Page           │
     │              │               │               │Offset         │ Offset         │  Offset         │
     └──────────────┴─┬─────────────┴─┬─────────────┴──┬────────────┴───┬────────────┴───┬─────────────┘
                      │9              │9               │9               │9               │21
                      │               │                │                │                │
                      │  ┌─────┐      │  ┌─────┐       │  ┌─────┐       │  ┌─────┐       │  ┌─────┐
                      │  │     │      │  │     │       │  │     │       │  │     │       │  │     │
                      │  │     │      │  │     │       │  │     │       │  │     │       │  │     │
                      │  │     │      │  │     │       │  │     │       │  │     │       │  │     │
                      │  │     │      │  │     │       │  │     │       │  │     │       │  │     │
                      │  ├─────┤      │  ├─────┤       │  ├─────┤       │  ├─────┤       │  ├─────┤
                      └─►│PML5E├───┐  └─►│PML4E│───┐   └─►│PDPE │───┐   └─►│PDE  │───┐   └─►│ PA  │
                         ├─────┤   │52   ├─────┤   │52    ├─────┤   │52    ├─────┤   │52    ├─────┤
                         │     │   │     │     │   │      │     │   │      │     │   │      │     │
                  ┌─────►└─────┘   └────►└─────┘   └─────►└─────┘   └─────►└─────┘   └─────►└─────┘
                  │        4K              4K               4K               4K                2MB
                  │
                  │
                  │
                  │
63         52  51 │                               12 11            0
┌─────────────┬───┴─────────────────────────────────┬───────────────┐
│             │    Page-Map Level-4 or Level-5      │               │
│    MBZ      │          Table Base Address         │               │  CR3
│             │                                     │               │
└─────────────┴─────────────────────────────────────┴───────────────┘

4-Kbyte PML5E—Long Mode

63  62              52 51                                    32
┌──┬──────────────────┬────────────────────────────────────────┐
│N │                  │                                        │
│X │     Available    │     Page-Map Level-4 Base Address      │
│  │                  │                                        │
└──┴──────────────────┴────────────────────────────────────────┘

31                                    12 11 9 8 7 6 5 4 3 2 1 0
┌───────────────────────────────────────┬────┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│                                       │    │M│M│I│ │P│P│U│R│ │
│     Page-Map Level-4 Base Address     │AVL │B│B│G│A│C│W│/│/│P│
│                                       │    │Z│Z│N│ │D│T│S│W│ │
└───────────────────────────────────────┴────┴─┴─┴─┴─┴─┴─┴─┴─┴─┘

4-Kbyte PML4E—Long Mode

63  62              52 51                                    32
┌──┬──────────────────┬────────────────────────────────────────┐
│N │                  │                                        │
│X │     Available    │     Page-Map Level-4 Base Address      │
│  │                  │                                        │
└──┴──────────────────┴────────────────────────────────────────┘

31                                    12 11 9 8 7 6 5 4 3 2 1 0
┌───────────────────────────────────────┬────┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│                                       │    │M│M│I│ │P│P│U│R│ │
│     Page-Map Level-4 Base Address     │AVL │B│B│G│A│C│W│/│/│P│
│                                       │    │Z│Z│N│ │D│T│S│W│ │
└───────────────────────────────────────┴────┴─┴─┴─┴─┴─┴─┴─┴─┴─┘

4-Kbyte PDPE—Long Mode

63  62              52 51                                    32
┌──┬──────────────────┬────────────────────────────────────────┐
│N │                  │                                        │
│X │     Available    │     Page-Map Level-4 Base Address      │
│  │                  │                                        │
└──┴──────────────────┴────────────────────────────────────────┘

31                                    12 11 9 8 7 6 5 4 3 2 1 0
┌───────────────────────────────────────┬────┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│                                       │    │I│ │I│ │P│P│U│R│ │
│     Page-Map Level-4 Base Address     │AVL │G│0│G│A│C│W│/│/│P│
│                                       │    │N│ │N│ │D│T│S│W│ │
└───────────────────────────────────────┴────┴─┴─┴─┴─┴─┴─┴─┴─┴─┘

4-Kbyte PDE—Long Mode

63  62              52 51                                    32
┌──┬──────────────────┬────────────────────────────────────────┐
│N │                  │                                        │
│X │     Available    │     Page-Map Level-4 Base Address      │
│  │                  │                                        │
└──┴──────────────────┴────────────────────────────────────────┘

31                   21 20         13 12 11 9 8 7 6 5 4 3 2 1 0
┌──────────────────────┬─────────────┬──┬────┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│  Page-Map Level-4    │             │P │    │ │ │ │ │P│P│U│R│ │
│  Base Address        │ MBZ         │A │AVL │G│1│D│A│C│W│/│/│P│
│                      │             │T │    │ │ │ │ │D│T│S│W│ │
└──────────────────────┴─────────────┴──┴────┴─┴─┴─┴─┴─┴─┴─┴─┴─┘

```
